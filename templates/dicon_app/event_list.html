{# templates/dicon_app/event_list.html #}
{% extends "dicon_app/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/events.css' %}">
{% endblock %}

{% block content %}
<div class="container py-4 dicon-event-list">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 mb-0">ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</h1>
    <div class="text-muted small">ä»Šæ—¥ï¼ˆ{{ today }}ï¼‰ä»¥é™</div>
  </div>

  <form class="row g-2 mb-4" method="get" action="">
    <div class="col-12 col-md-3">
      <select class="form-select" name="tag">
        <option value="">ã‚«ãƒ†ã‚´ãƒªï¼šã™ã¹ã¦</option>
        {% for value, label in category_choices %}
          <option value="{{ value }}" {% if tag == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-12 col-md-7">
      <input class="form-control" type="text" name="q" value="{{ q }}"
             placeholder="æ¤œç´¢ï¼ˆã‚¿ã‚¤ãƒˆãƒ« / ä¸€è¨€èª¬æ˜ / è©³ç´° / å ´æ‰€ï¼‰">
    </div>

    <div class="col-12 col-md-2 d-grid">
      <button class="btn btn-primary" type="submit">æ¤œç´¢</button>
    </div>
  </form>

  <!-- {# ----------------------------
     å®šç•ªï¼ˆå¸¸æ™‚å‘ŠçŸ¥ï¼‰
     ---------------------------- #} -->
  <div class="d-flex align-items-center justify-content-between mt-2 mb-2">
    <h2 class="h6 mb-0">å®šç•ªï¼ˆã„ã¤ã‚‚ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼‰</h2>
    <div class="text-muted small">æ›œæ—¥ãƒ»æœˆä¸€ãƒ»5ã®ä»˜ãæ—¥ãªã©</div>
  </div>

  {% if regular_events %}
    <div class="row g-3 mb-4">
      {% for event in regular_events %}
        <div class="col-12 col-md-6">
          <div class="card h-100 shadow-sm border-0" style="border-radius:18px;">
            {% if event.image %}
              <img src="{% static event.image %}" class="card-img-top"
                   alt="{{ event.title }}"
                   style="border-top-left-radius:18px;border-top-right-radius:18px;object-fit:cover;max-height:220px;">
            {% endif %}

            <div class="card-body">
              <div class="d-flex flex-wrap gap-2 align-items-center mb-2">
                <span class="badge rounded-pill text-bg-primary">{{ event.get_category_display }}</span>
                {% if event.is_featured %}
                  <span class="badge rounded-pill text-bg-warning">PICKUP</span>
                {% endif %}

                {% if event.display_date_text %}
                  <span class="text-muted small">{{ event.display_date_text }}</span>
                {% endif %}

              </div>

              <h3 class="h6 mb-2">{{ event.title }}</h3>

              {% if event.summary %}
                <p class="mb-2 text-muted">{{ event.summary }}</p>
              {% endif %}

              {% if event.location %}
                <div class="small mb-3">
                  <span class="text-danger">ğŸ“</span> {{ event.location }}
                </div>
              {% endif %}

              <div class="d-flex flex-wrap gap-2">
                <a class="btn btn-outline-primary btn-sm" href="{{ event.get_absolute_url }}">è©³ç´°ã‚’è¦‹ã‚‹</a>
                {% if event.map_url %}
                  <a class="btn btn-outline-secondary btn-sm" href="{{ event.map_url }}" target="_blank" rel="noopener">åœ°å›³</a>
                {% endif %}
                {% if event.apply_url %}
                  <a class="btn btn-primary btn-sm" href="{{ event.apply_url }}" target="_blank" rel="noopener">ç”³ã—è¾¼ã‚€</a>
                {% endif %}
              </div>

            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-light border mb-4">å®šç•ªã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
  {% endif %}


  <!-- {# ----------------------------
     ã‚¹ãƒãƒƒãƒˆï¼ˆæœŸé–“/å˜ç™ºï¼‰
     ---------------------------- #} -->
  <div class="d-flex align-items-center justify-content-between mb-2">
    <h2 class="h6 mb-0">ä»Šæœˆã®ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæœŸé–“/å˜ç™ºï¼‰</h2>
    <div class="text-muted small">start_date ãŒä»Šæ—¥ä»¥é™ã®ã‚‚ã®</div>
  </div>

  {% if events %}
    <div class="row g-3">
      {% for event in events %}
        <div class="col-12 col-md-6">
          <div class="card h-100 shadow-sm border-0" style="border-radius:18px;">
            {% if event.image %}
              <img src="{% static event.image %}" class="card-img-top"
                   alt="{{ event.title }}"
                   style="border-top-left-radius:18px;border-top-right-radius:18px;object-fit:cover;max-height:220px;">
            {% endif %}

            <div class="card-body">
              <div class="d-flex flex-wrap gap-2 align-items-center mb-2">
                <span class="badge rounded-pill text-bg-primary">{{ event.get_category_display }}</span>
                {% if event.is_featured %}
                  <span class="badge rounded-pill text-bg-warning">PICKUP</span>
                {% endif %}

                <span class="text-muted small">
                  {% if event.display_date_text %}
                <span class="text-muted small">{{ event.display_date_text }}</span>
                {% endif %}

                </span>
              </div>

              <h3 class="h6 mb-2">{{ event.title }}</h3>

              {% if event.summary %}
                <p class="mb-2 text-muted">{{ event.summary }}</p>
              {% endif %}

              {% if event.location %}
                <div class="small mb-3">
                  <span class="text-danger">ğŸ“</span> {{ event.location }}
                </div>
              {% endif %}

              <div class="d-flex flex-wrap gap-2">
                <a class="btn btn-outline-primary btn-sm" href="{{ event.get_absolute_url }}">è©³ç´°ã‚’è¦‹ã‚‹</a>
                {% if event.map_url %}
                  <a class="btn btn-outline-secondary btn-sm" href="{{ event.map_url }}" target="_blank" rel="noopener">åœ°å›³</a>
                {% endif %}
                {% if event.apply_url %}
                  <a class="btn btn-primary btn-sm" href="{{ event.apply_url }}" target="_blank" rel="noopener">ç”³ã—è¾¼ã‚€</a>
                {% endif %}
              </div>

            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-light border">æ¡ä»¶ã«åˆã†ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
  {% endif %}

</div>
{% endblock %}
