{% extends "base.html" %}
{% load static %}

{% block title %}ホーム{% endblock %}

{% block content %}

<style>
  /* 全体の背景色（広島レッド）とドット柄 */
  body {
    background-color: #b71c1c !important;
    background-image: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size: 20px 20px;
    color: white;
  }
  
  /* セクションごとの背景（白ベース） */
  .section-card {
    background-color: #f8f9fa;
    color: #333;
    border-radius: 1.5rem;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    margin-bottom: 3rem;
  }

  /* ヒーロー画像のカルーセル矢印を見やすく */
  .carousel-control-prev-icon,
  .carousel-control-next-icon {
    filter: drop-shadow(0px 0px 3px rgba(0,0,0,0.5));
  }
  
  /* アニメーション */
  .animate-pulse { animation: pulse 2s infinite; }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
  .hover-scale { transition: transform 0.2s; }
  .hover-scale:hover { transform: scale(1.03); }

  @keyframes scan {
      0% { top: 20%; opacity: 0.8; }
      50% { top: 70%; opacity: 0.8; }
      100% { top: 20%; opacity: 0.8; }
  }
  @keyframes floatHand {
      0%, 100% { transform: translateY(0) rotate(-30deg); }
      50% { transform: translateY(-15px) rotate(-30deg); }
  }
</style>

<section class="position-relative w-100 overflow-hidden d-flex align-items-center justify-content-center mb-5" style="min-height: 600px; background-color: #333;">
  {% if slides and slides.0.image %}
    <div class="position-absolute top-0 start-0 w-100 h-100" style="background-image: url('{{ slides.0.image.url }}'); background-size: cover; background-position: center; z-index: 0;"></div>
  {% else %}
    <div class="position-absolute top-0 start-0 w-100 h-100" style="background-image: url('{% static 'img/shopping_street_bg.jpg' %}'); background-size: cover; background-position: center; z-index: 0;"></div>
  {% endif %}
  <div class="position-absolute top-0 start-0 w-100 h-100 bg-dark" style="opacity: 0.3; z-index: 1;"></div>
  <div class="container position-relative text-center z-2 px-3 py-5">
    <div class="mb-4">
      <div class="d-flex justify-content-center align-items-end mb-3">
        <img src="{% static 'img/hero_smartphone.png' %}" style="width: 150px; max-width: 30vw; height: auto; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.6)); transform: rotate(-8deg) translateX(5px); z-index: 2;">
        <img src="{% static 'img/hero_locker.png' %}" style="width: 180px; max-width: 35vw; height: auto; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.6)); transform: translateX(-5px); z-index: 1;">
      </div>
      <h1 class="text-white fw-bold mb-4" style="font-family: 'Mochiy Pop One', sans-serif; text-shadow: 0 4px 15px rgba(0,0,0,0.9); font-size: clamp(1.5rem, 4.5vw, 3.5rem);">アプリで注文、ロッカーで受取</h1>
      <p class="text-white fw-bold opacity-95 mx-auto" style="font-size: clamp(1rem, 2.5vw, 1.3rem); line-height: 1.9;">
        ニッチな注文も、チャットで店に相談してや!<br>
        駅前の商店街で、「あなた専用」の注文を受け取ってな。
      </p>
    </div>
    <div class="mt-5 d-flex flex-column flex-sm-row justify-content-center gap-3">
      <a href="{% url 'dicon_app:shop_list' %}" class="btn btn-danger btn-lg rounded-pill px-5 py-3 shadow fw-bold hover-scale border-2 border-white">お店をのぞく</a>
      <a href="{% url 'dicon_app:consult_home' %}" class="btn btn-outline-light btn-lg rounded-pill px-5 py-3 shadow fw-bold hover-scale">チャットで相談</a>
    </div>
  </div>
</section>

<section class="container mb-5" style="margin-top: -3rem; position: relative; z-index: 10;">
  <div class="row g-3 justify-content-center">
    <div class="col-md-4">
      <div class="card h-100 border-0 shadow text-center py-4 px-3 rounded-4 bg-white text-dark">
        <div class="position-absolute top-0 start-50 translate-middle"><span class="badge rounded-pill bg-danger border border-4 border-white shadow-sm px-3 py-2">STEP 1</span></div>
        <div class="mt-4 mb-2 text-danger"><i class="fa-solid fa-mobile-screen-button fa-3x"></i></div>
        <h5 class="fw-bold mb-3">スマホで注文・相談</h5>
        <p class="text-muted small mb-0 lh-sm">通勤時間や隙間時間にポチッ。<br>「子供が食べるから薄味で」そんなニーズもOK。</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card h-100 border-0 shadow text-center py-4 px-3 rounded-4 bg-white text-dark">
        <div class="position-absolute top-0 start-50 translate-middle"><span class="badge rounded-pill bg-danger border border-4 border-white shadow-sm px-3 py-2">STEP 2</span></div>
        <div class="mt-4 mb-2 text-danger"><i class="fa-solid fa-fire-burner fa-3x"></i></div>
        <h5 class="fw-bold mb-3">商店街のプロが手作り</h5>
        <p class="text-muted small mb-0 lh-sm">八百屋の野菜、肉屋のコロッケ。<br>コンビニとは違う「手作りの味」を。</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card h-100 border-0 shadow text-center py-4 px-3 rounded-4 bg-white text-dark">
        <div class="position-absolute top-0 start-50 translate-middle"><span class="badge rounded-pill bg-danger border border-4 border-white shadow-sm px-3 py-2">STEP 3</span></div>
        <div class="mt-4 mb-2 text-danger"><i class="fa-solid fa-box-open fa-3x"></i></div>
        <h5 class="fw-bold mb-3">ロッカーで待たずに受取</h5>
        <p class="text-muted small mb-0 lh-sm">QRコードをかざすだけで、<br>商店街は「おかえり」を待ってます。</p>
      </div>
    </div>
  </div>
</section>

{% if sale_products %}
<section id="sale" class="container mb-5 text-white">
  <div class="d-flex justify-content-between align-items-end mb-3">
    <h2 class="h4 fw-bold m-0"><i class="fa-solid fa-fire text-warning me-2"></i>本日の特売</h2>
    <a href="{% url 'dicon_app:sale_list' %}" class="btn btn-outline-light btn-sm rounded-pill px-3">すべて見る &raquo;</a>
  </div>
  <div class="row row-cols-2 row-cols-lg-6 g-3">
    {% for product in sale_products %}
    <div class="col">
      <a href="{% url 'dicon_app:product_detail' product.pk %}" class="card h-100 border-0 shadow-sm text-decoration-none hover-scale rounded-4 text-dark">
        <div class="position-relative">
          {% if product.image %}<img src="{{ product.image.url }}" class="card-img-top bg-light" style="height: 120px; object-fit: cover; border-radius: 1rem 1rem 0 0;">{% endif %}
          <span class="position-absolute top-0 start-0 bg-danger text-white px-2 py-1 m-1 rounded-pill small fw-bold">SALE</span>
        </div>
        <div class="card-body p-3 pt-2 text-dark">
          <h6 class="small fw-bold text-truncate mb-1">{{ product.name }}</h6>
          <div class="d-flex justify-content-between align-items-end"><span class="text-danger fw-bold">{{ product.sale_price }}円</span></div>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

{% if recommended_sets %}
<section id="recommended-sets" class="container mb-5 text-white">
  <div class="d-flex justify-content-between align-items-end mb-4">
    <h2 class="h4 fw-bold m-0"><i class="fa-solid fa-utensils text-white me-2"></i>管理栄養士監修 おすすめ献立セット</h2>
    <a href="{% url 'dicon_app:set_list' %}" class="btn btn-outline-light btn-sm rounded-pill px-3 shadow-sm">すべて見る &raquo;</a>
  </div>
  <div class="row g-3 justify-content-center">
    {% for set in recommended_sets %}
    <div class="col-md-6 col-lg-4">
      <a href="{% url 'dicon_app:set_detail' pk=set.pk %}" class="card h-100 border-0 shadow-sm hover-scale rounded-4 overflow-hidden text-decoration-none text-dark bg-white">
        <div class="position-relative">
          {% if set.image %}<img src="{{ set.image.url }}" class="card-img-top" style="height: 200px; object-fit: cover;">
          {% else %}<div class="card-img-top bg-light d-flex align-items-center justify-content-center text-muted" style="height: 200px;"><i class="fa-solid fa-utensils fa-2x"></i></div>{% endif %}
          <span class="position-absolute top-0 end-0 bg-success text-white px-3 py-1 m-2 rounded-pill fw-bold small shadow-sm">管理栄養士監修</span>
        </div>
        <div class="card-body p-3 d-flex flex-column">
          <h5 class="fw-bold fs-6 mb-2">{{ set.name }}</h5>
          <p class="small text-muted mb-3 flex-grow-1">{{ set.description|truncatechars:40 }}</p>
          <div class="d-flex justify-content-between align-items-center mt-auto">
            <span class="text-danger fw-bold fs-5">{% if set.total_price %}¥{{ set.total_price }}{% else %}CHECK{% endif %}</span>
            <span class="small fw-bold text-success">詳細を見る <i class="fa-solid fa-chevron-right ms-1"></i></span>
          </div>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

<section id="concierge" class="container mb-5">
  <div class="section-card p-4 p-lg-5">
    <div class="row align-items-end mb-4 text-dark text-center text-lg-start">
        <div class="col-lg-8">
          <span class="badge bg-success mb-2 px-3">商店街の食のプロ監修</span>
          <h2 class="fw-bold fs-2 mb-2">「忙しい！ごはん何しよ？！」<br>その悩み、Diconアプリが引き受けた！</h2>
          <p class="text-muted mb-0">下ごしらえやレシピの悩みは、商店街のおばちゃんら（おっちゃんも）に任せてや〜！</p>
        </div>
    </div>
    <div class="row g-3 justify-content-center mb-4">
      {% for pickup in home_pickups %}
      <div class="col-md-6 col-lg-4">
          <a href="{% url pickup.link_url_name %}" class="card h-100 border-0 shadow-sm hover-scale rounded-4 overflow-hidden text-decoration-none text-dark bg-white">
              <div class="position-relative">
                  {% if pickup.image %}<img src="{{ pickup.image.url }}" class="card-img-top" style="height: 200px; object-fit: cover;">{% endif %}
                  {% if pickup.badge_text %}<span class="position-absolute top-0 end-0 bg-danger text-white px-3 py-1 m-2 rounded-pill fw-bold small shadow-sm">{{ pickup.badge_text }}</span>{% endif %}
              </div>
              <div class="card-body p-3 d-flex flex-column"><h5 class="fw-bold fs-6 mb-2">{{ pickup.title }}</h5><p class="small text-muted mb-3 flex-grow-1">{{ pickup.description }}</p></div>
          </a>
      </div>
      {% endfor %}
    </div>

    <div class="container pt-2 pb-4 mb-4"> 
      <a href="{% url 'dicon_app:concierge_list' %}" class="btn btn-dark w-100 rounded-pill py-3 fw-bold shadow-sm">おばちゃんコンシェルジュのおすすめ一覧へ</a>
    </div>

    <hr class="my-5 border-secondary border-opacity-10">

    <div class="row align-items-end mb-4">
        <div class="col-lg-8">
            <span class="text-warning fw-bold small ls-1">CONCIERGE</span>
            <h3 class="fw-bold m-0 text-dark">困ったときの“おせっかい”相談所</h3>
            <p class="text-muted small mt-2 mb-0">「予算2000円で」「魚をさばいて」... 時間かかるとこは全部プロにお任せ！</p>
        </div>
    </div>

    <div class="row g-4 mb-4">
      {% for item in consultation_items|slice:":3" %}
      <div class="col-md-4">
          <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden text-dark bg-white">
              {% if item.image %}<img src="{{ item.image.url }}" class="card-img-top" style="height: 220px; object-fit: cover;">{% endif %}
              <div class="card-body p-4 text-center">
                  <h3 class="h6 fw-bold mb-3">【{{ item.title }}】</h3>
                  <p class="text-muted small mb-4" style="height: 4.8em; overflow: hidden;">{{ item.description }}</p>
                  <a href="{% url 'dicon_app:consult_home' %}?preset={{ item.preset_id }}" class="btn btn-outline-success w-100 rounded-pill fw-bold">相談する</a>
              </div>
          </div>
      </div>
      {% endfor %} 
    </div>

    <div class="container pt-2 pb-4 mb-4"> 
      <a href="{% url 'dicon_app:consult_menu' %}" class="btn btn-dark w-100 rounded-pill py-3 fw-bold shadow-sm border-0" style="background-color: #1a1a1a;">すべての相談メニューと相談ボタンはこちら</a>
    </div>
  </div>
</section>

<section id="locker" class="container mb-5">
  <div class="section-card p-0 text-white overflow-hidden rounded-4 shadow-lg" style="background: linear-gradient(135deg, #2E7D32 0%, #66BB6A 100%);">
    <div class="row g-0 align-items-center">
      <div class="col-lg-6 p-5">
        <span class="badge bg-warning text-dark fw-bold mb-3 px-3 py-2 rounded-pill animate-pulse">24時間受取OK</span>
        <h2 class="fw-bold display-6 mb-4" style="font-family: 'Mochiy Pop One', sans-serif;">お店の閉店時間は、気にしなくて大丈夫。</h2>
        <p class="opacity-90 mb-4">専用冷蔵ロッカーが、あなたの冷蔵庫代わりになります。受け取りはQRコードをかざすだけ。</p>
        <a href="{% url 'dicon_app:locker_guide' %}" class="badge bg-white text-success fw-bold px-3 py-2 rounded-pill text-decoration-none shadow-sm animate-pulse">使い方を見る</a>
      </div>
      <div class="col-lg-6 position-relative d-flex align-items-center justify-content-center py-5">
        <div class="position-relative shadow-lg" style="width: 260px; height: 500px; background: #000; border-radius: 40px; border: 8px solid #1a1a1a;">
          <div class="w-100 h-100 bg-white overflow-hidden position-relative d-flex flex-column" style="border-radius: 32px;">
            <div class="bg-white border-bottom pt-4 pb-2 px-3 text-dark d-flex justify-content-between align-items-center"><i class="fa-solid fa-bars"></i><span class="fw-bold small">受取キー</span><i class="fa-regular fa-bell"></i></div>
            <div class="flex-grow-1 d-flex flex-column align-items-center justify-content-center px-4 bg-light text-dark text-center">
                <div class="bg-white p-4 rounded-4 shadow-sm w-100 position-relative mb-3">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=DiconKey" style="width: 140px;">
                    <div class="position-absolute start-0 w-100 bg-danger opacity-25" style="height: 4px; top: 20%; animation: scan 2.5s infinite ease-in-out;"></div>
                </div>
                <div class="bg-dark text-white rounded-3 p-2 w-100">BOX: B-05</div>
            </div>
            <div class="p-3 bg-white border-top"><button class="btn btn-danger w-100 rounded-pill fw-bold shadow-sm">解錠する</button></div>
          </div>
        </div>
        <div class="position-absolute bottom-0 end-0 p-5 text-white" style="animation: floatHand 3s infinite ease-in-out;"><i class="fa-solid fa-hand-pointer fa-4x text-warning"></i></div>
      </div>
    </div>
  </div>
</section>

{% if upcoming_events %}
<section id="event" class="container mb-5 text-dark">
  <div class="section-card p-4 p-lg-5 bg-white shadow-sm rounded-4">
    <div class="text-center mb-5"><h2 class="fw-bold display-6">週末、どこいく？商店街で遊ぼ！</h2></div>
    <div class="row g-4">
      {% for event in upcoming_events %}
        <div class="col-md-6">
          <a href="{% url 'dicon_app:event_detail' slug=event.slug %}" class="text-decoration-none text-dark">
            <div class="card h-100 border hover-scale rounded-4 overflow-hidden bg-white">
              <div class="ratio ratio-16x9">{% if event.image %}<img src="{{ event.image.url }}" class="object-fit-cover">{% endif %}</div>
              <div class="card-body p-4 bg-white"><h4 class="fw-bold mb-2">{{ event.title }}</h4><p class="text-muted small mb-0">{{ event.description|truncatechars:50 }}</p></div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<section id="partner" class="container mb-5 text-dark">
  <div class="section-card p-4 p-lg-5">
      <h2 class="fw-bold display-6 mb-5 text-center text-dark">商店街は、もっと頼れる場所へ。</h2>
      <div class="row g-4">
          {% for partner in partners %}
          <div class="col-lg-6">
              <div class="card h-100 border-0 shadow-sm rounded-4 hover-scale bg-light p-3 text-dark">
                  <div class="row g-0 align-items-center">
                      <div class="col-4 text-center">{% if partner.image %}<img src="{{ partner.image.url }}" class="rounded-circle shadow-sm" style="width: 100px; height: 100px; object-fit: cover;">{% endif %}</div>
                      <div class="col-8"><div class="card-body p-2"><h5 class="fw-bold mb-1">{{ partner.name }}</h5><p class="small text-muted mb-0">{{ partner.description|truncatechars:100 }}</p></div></div>
                  </div>
              </div>
          </div>
          {% endfor %}
      </div>
  </div>
</section>

<section id="vacant-store" class="container mb-5 text-center">
  <div class="section-card p-4 p-lg-5">
      <span class="badge bg-warning text-dark mb-2 px-3 py-2 rounded-pill fw-bold">VACANT STORE</span>
      <h2 class="fw-bold display-6 mb-3 text-dark">この街で、あなたの夢を。<br>空き店舗、こうなってます。</h2>
      <div class="card border-0 rounded-4 overflow-hidden shadow-lg text-white position-relative" style="background: url('https://images.unsplash.com/photo-1556740758-90de374c12ad?auto=format&fit=crop&w=1200&q=80') center/cover; min-height: 450px;">
          <div class="position-absolute top-0 start-0 w-100 h-100 bg-dark opacity-75"></div>
          <div class="card-body p-5 position-relative z-1 d-flex flex-column justify-content-center h-100">
              <p class="lead mb-5 text-white fw-bold" style="text-shadow: 0 2px 4px rgba(0,0,0,0.5);">古い金物屋が「古着バー」に。時計屋さんが「レトロ喫茶」に。<br>新しいおせっかいが、街を面白くしています。</p>
              
              <div class="row g-3 mb-5 justify-content-center">
                  <div class="col-4 col-md-2"><img src="https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=200" class="rounded-4 w-100 border border-3 border-white shadow" style="height: 80px; object-fit: cover;"></div>
                  <div class="col-4 col-md-2"><img src="https://images.unsplash.com/photo-1524316885361-b1b6c0e5a6b0?w=200" class="rounded-4 w-100 border border-3 border-white shadow" style="height: 80px; object-fit: cover;"></div>
                  <div class="col-4 col-md-2"><img src="https://images.unsplash.com/photo-1595856488331-507949392289?w=200" class="rounded-4 w-100 border border-3 border-white shadow" style="height: 80px; object-fit: cover;"></div>
              </div>

              <a href="{% url 'dicon_app:vacant_store' %}" class="btn btn-warning text-dark rounded-pill px-5 py-3 fw-bold shadow-lg hover-scale mx-auto">空き物件情報を見る</a>
          </div>
      </div>
  </div>
</section>

{% endblock %}