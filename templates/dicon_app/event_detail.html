{# templates/dicon_app/event_detail.html #}
{% extends "dicon_app/base.html" %}
{% load static %}

{# ã‚¤ãƒ™ãƒ³ãƒˆãƒšãƒ¼ã‚¸ã ã‘ events.css ã‚’èª­ã¿è¾¼ã‚€ï¼ˆäº‹æ•…é˜²æ­¢ï¼‰ #}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/events.css' %}">
{% endblock %}

{% block title %}{{ event.title }} | Dicon{% endblock %}

{% block content %}
<div class="dicon-event-detail">

  <a href="{% url 'dicon_app:event_list' %}" class="text-decoration-none">â† ä¸€è¦§ã¸æˆ»ã‚‹</a>

  <div class="card shadow-sm border-0 mt-3" style="border-radius:18px;">
    <div class="card-body p-4">

      <div class="d-flex flex-wrap gap-2 align-items-center mb-2">
        <span class="badge rounded-pill text-bg-primary">{{ event.get_category_display }}</span>

        {% if event.is_featured %}
          <span class="badge rounded-pill text-bg-warning">PICKUP</span>
        {% endif %}

        <span class="text-muted small">
          {% if event.end_date and event.end_date > event.start_date %}
            {{ event.start_date }} ã€œ {{ event.end_date }}
          {% else %}
            {{ event.start_date }}
          {% endif %}
        </span>
      </div>

      <h1 class="h4 mb-3">{{ event.title }}</h1>

      {% if event.image %}
        <img src="{% static event.image %}" alt="{{ event.title }}"
             class="w-100 mb-3"
             style="border-radius:14px;object-fit:cover;max-height:420px;">
      {% endif %}

      {% if event.body %}
        <div class="mb-4 event-body">
          {{ event.body|linebreaksbr }}
        </div>
      {% endif %}

      {% if event.location %}
        <div class="mb-3">
          <span class="text-danger">ğŸ“</span> {{ event.location }}
        </div>
      {% endif %}

      <div class="d-flex flex-wrap gap-2 mb-3 event-actions">
        {% if event.map_url %}
          <a class="btn btn-outline-secondary" href="{{ event.map_url }}" target="_blank" rel="noopener">
            åœ°å›³ã‚’è¦‹ã‚‹
          </a>
        {% endif %}

        {% if event.apply_url %}
          <a class="btn btn-primary" href="{{ event.apply_url }}" target="_blank" rel="noopener">
            ç”³ã—è¾¼ã‚€
          </a>
        {% endif %}
      </div>

      <hr>

      <div class="d-flex flex-wrap gap-2 align-items-center">
        <button class="btn btn-outline-dark btn-sm" type="button" id="copyLinkBtn">
          å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼
        </button>

        {% if event.share_text %}
          <span class="text-muted small">{{ event.share_text }}</span>
        {% endif %}
      </div>

      <input type="text" id="shareUrl" value="{{ share_url }}" class="form-control mt-2" readonly>

    </div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
  (function() {
    const btn = document.getElementById("copyLinkBtn");
    const input = document.getElementById("shareUrl");

    btn?.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(input.value);
        btn.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
        setTimeout(() => (btn.textContent = "å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼"), 1500);
      } catch (e) {
        input.select();
        document.execCommand("copy");
        btn.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
        setTimeout(() => (btn.textContent = "å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼"), 1500);
      }
    });
  })();
</script>
{% endblock %}
