{% extends "base.html" %}
{% block title %}{{ set.name }}｜おすすめセット{% endblock %}

{% block content %}
<h1>{{ set.name }}</h1>
{% if set.description %}<p>{{ set.description }}</p>{% endif %}

{# ✅ セット詳細 → 相談（set.shop_id は使わない） #}
{% with first_product=set.products.all|first %}
  {% if first_product and first_product.shop_id %}
    <a class="btn btn-outline-success"
       href="{% url 'dicon_app:shop_consult' shop_pk=first_product.shop_id %}?set={{ set.name|urlencode }}">
      LINEでこのセットを相談
    </a>
  {% else %}
    <p class="text-muted">※ このセットに紐づく店舗が特定できませんでした</p>
  {% endif %}
{% endwith %}

<h2>このセットの商品</h2>
<ul>
  {% for product in set.products.all %}
    <li>
      <a href="{% url 'dicon_app:product_detail' product.id %}">{{ product.name }}</a>
      （{{ product.price }}円）
    </li>
  {% empty %}
    <li>商品がまだ紐づいていません</li>
  {% endfor %}
</ul>

<a class="btn btn-dark"
   href="{% url 'payments:checkout_set' set.slug %}">
  このセットをまとめて購入
</a>

<div class="mt-5 text-center">
  <div class="mb-3">
    <a href="javascript:history.back()" class="btn btn-outline-secondary rounded-pill px-4">
      <i class="fa-solid fa-chevron-left me-2"></i>前の画面に戻る
    </a>
  </div>

  <a href="{% url 'dicon_app:home' %}" class="text-muted small text-decoration-none">
    <i class="fa-solid fa-house me-1"></i>トップページへ
  </a>
</div>
{% endblock %}
